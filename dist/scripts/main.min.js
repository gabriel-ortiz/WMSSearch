!function(a,t,e){"use strict";a.WMSSearch=function(t,e){var s=this,r=a(t),t=t;s.options=a.extend(!0,a.fn.WMSSearch.options,e);var o,i;s.options.scoped_search_settings.scoped_searchbox===!0?(i="col--md-6",o="col--md-3"):(i="col--md-10",o="col--md-3");var d=a("<div />").addClass("row wms-row").append(a("<div />").addClass("col col--md-12").append(a("<h3 />").addClass("wms-c-title").text("Search for "+s.options.scoped_search_settings.scoped_search_title)).append(a("<div />").addClass("wms-c-scoped-description").text(s.options.scoped_search_settings.scoped_search_desc))),n=a("<div />").addClass("row wms-row").append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+i+" wms-search wms-c-keyword")),c=a("<div />").addClass("row wms-row").attr("id","wms-search-for").append(a("<div />").addClass("col col--md-2").append(a("<h3 />").addClass("wms-c-title").text("Search For:"))).append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+i+" wms-search wms-c-keyword")),p=a("<div />").addClass("row wms-row").attr("id","wms-search-rows"),l=a("<div />").addClass("col "+o+" wms-row").append(a("<button />").attr({type:"submit"}).addClass(" wms-button wms-search wms-submit wms-search-button").text("Search")),m=[{id:"kw",name:"Keyword",paramater:"kw",order:"primary"},{id:"ti",name:"Title",paramater:"ti"},{id:"au",name:"Author",paramater:"au"},{id:"bn",name:"ISBN",paramater:"bn"},{id:"su",name:"Subject",paramater:"su"},{id:"no",name:"OCLC Number",paramater:"no"},{id:"so",name:"Journal Source",paramater:"so"},{id:"yr",name:"Year",paramater:"yr"},{id:"n2",name:"ISSN",paramater:"n2"},{id:"nu",name:"Call Number",paramater:"nu"}],_=[{id:"all",name:"Everything",paramater:"all",order:"primary"},{id:"book",name:"Print Books",paramater:"Book"},{id:"ebook",name:"eBooks",paramater:"Book::book_digital"},{id:"dvd",name:"DVDs",paramater:"Video::video_dvd"},{id:"journal",name:"Journal/Magazine",paramater:"Artchap::artchap_artcl"},{id:"music",name:"Musical Scores",paramater:"Msscr"}],h=function(t,e,s,r){var i,d=u(s,r),n=[],c=d.filter(function(a){return"primary"==a.order?"primary"==a.order:d[0]});a.each(d,function(t,e){i=a("<li />").attr({"class":"wms-select_attr","data-wms_attr":e.paramater,role:"menuitem",tabindex:"0","aria-hidden":"true"}).text(e.name),n.push(i)});var p=a("<div />").addClass("col "+o+" wms-row"),l=a("<div />").addClass("wms-dropdown wms-search").attr({tabindex:"0",role:"button","aria-label":"Search Attribute"}).append(a("<div />").addClass("wms-c-selected").append(a("<span />").addClass("wms-prompt").text(e+":")).append(a("<span />").addClass("wms-selected-item type-"+t).attr({"data-wms_attr":c[0].paramater,"data-wms_type":t}).text(c[0].name)).append(a("<span />").addClass("wms-arrow__toggle").html("&#10097;"))),m=a("<div />").addClass("wms-items").append(a("<ul />").addClass("wms-list-options").attr({role:"menu","aria-haspopup":"true"}).append(n));return l.append(m),p.append(l),p},u=function(t,e){return a.each(e,function(a,e){t=t.filter(function(a){return e!==a.id})}),t},w=function(t){var e,r,o,i,d;s.options.scoped_search_settings.scoped_searchbox===!0&&""==s.options.scoped_search_settings.scoped_search_scoping?(e=t.attr,o=s.options.scoped_search_settings.scoped_search_location):s.options.scoped_search_settings.scoped_searchbox===!0?(e="("+s.options.scoped_search_settings.scoped_search_scoping+") "+s.options.scoped_search_settings.scoped_search_boolean+" "+t.attr,o=s.options.scoped_search_settings.scoped_search_location):(e=t.attr,o=t.src),t.frmt.match(/(digital|dvd|artchap_artcl)/)&&s.options.scoped_search_settings.scoped_searchbox!==!0?(r="subformat",d=t.frmt):(r="format",d=t.frmt),i=o.match(/::zs:/)?"subscope":"scope";var n={sortKey:s.options.defaults.sortKey,databaseList:s.options.defaults.databaseList,queryString:e,Facet:"",database:s.options.additional_settings.database||"all",author:s.options.additional_settings.author,year:s.options.additional_settings.year||"all",yearFrom:s.options.additional_settings.yearFrom,yearTo:s.options.additional_settings.yearTo,language:s.options.additional_settings.language||"all",topic:s.options.additional_settings.topic};n[i]=o,n[r]=d;var c=s.options.defaults.wms_base_url+a.param(n);return c=c.replace("%26","&")};s.controller=function(){if(s.options.scoped_search_settings.scoped_searchbox===!0){var t=h("attr","AS",m,s.options.additional_settings.omit_attributes);n.append(t,l),r.addClass("grid grid--container").append(d,n)}else{var e=h("attr","AS",m,s.options.additional_settings.omit_attributes),o=h("frmt","FOR",_,s.options.additional_settings.omit_formats),i=h("src","IN",s.options.defaults.collections,s.options.additional_settings.omit_collections);p.append(e,o,i,l),r.append([c,p]).addClass("grid grid--container")}r.on("keypress click",".wms-dropdown",function(t){if(13==t.keyCode||"click"==t.type){var e=a(this),s=e.find(".wms-list-options"),r=e.find(".wms-arrow__toggle");r.toggleClass("toggle-up"),a(".wms-arrow__toggle").not(r).removeClass("toggle-up"),s.slideToggle("fast"),a(".wms-list-options").not(s).slideUp("fast")}}).on("click keypress","li.wms-select_attr",function(t){if(13==t.keyCode||"click"==t.type){var e=a(t.target),s=e.attr("data-wms_attr"),r=e.text();e.parents(".wms-search").find(".wms-selected-item").text(r).attr("data-wms_attr",s)}}).on("click",".wms-submit",function(t){t.preventDefault();var e="";e=a(".wms-selected-item");var r=a('input[name="keyword"]').val(),o=[];s.options.scoped_search_settings.scoped_searchbox===!0&&(o.attr=e.attr("data-wms_attr")+":"+r,o.frmt=s.options.scoped_search_settingsscoped_search_format||"all",o.src=s.options.scoped_search_settings.scoped_search_scoping||""),a.each(e,function(t,e){"attr"==a(e).attr("data-wms_type")?(o.attr="",o.attr=a(e).attr("data-wms_attr")+":"+r):"frmt"==a(e).data("wms_type")?(o.frmt="",o.frmt=a(e).attr("data-wms_attr")):"src"==a(e).data("wms_type")&&(o.src="",o.src=a(e).attr("data-wms_attr"))});var i=w(o);console.log(i),o=[],e=""}),a("body").on("click",function(t){0===a(t.target).parents(".wms-dropdown").length&&(a(".wms-list-options").slideUp("fast"),a(".wms-arrow__toggle").removeClass("toggle-up"))})}},a.fn.WMSSearch=function(t){return this.each(function(){if(void 0==a(this).data("WMSSearch")){var e=new a.WMSSearch(this,t);e.controller(),a(this).data("WMSSearch",e)}})},a.fn.WMSSearch.options={defaults:{wms_base_url:"https://ccl.on.worldcat.org/search?",sortKey:"LIBRARY",databaseList:"",collections:[{id:"all",name:"General Collections",paramater:"wz:519",order:"primary"},{id:"spcl",name:"Special Collections",paramater:"wz:519::zs:36307"}]},scoped_search_settings:{scoped_searchbox:!1,scoped_search_title:"",scoped_search_desc:"",scoped_search_scoping:"",scoped_search_location:"",scoped_search_format:"all",scoped_search_boolean:"AND"},additional_settings:{database:"all",author:"",year:"all",yearFrom:"",yearTo:"",language:"all",topic:"",omit_attributes:["n2"],omit_formats:["music"],omit_collections:[],searchbox_help:"Enter a keyword into the search box to get started",search_attr_help:"What are you searching as? Attributes help you narrow your search",search_source_attr:"Where would you like to search. Here are different collections materials to narrow your search"}}}(jQuery,window,document);