!function(a,t,e){"use strict";a.WMSSearch=function(e,s){var r=this,o=a(e),e=e;r.options=a.extend(!0,a.fn.WMSSearch.options,s);var i,n;r.options.scoped_search_settings.scoped_searchbox===!0?(n="col--md-6",i="col--md-3"):(n="col--md-10",i="col--md-3");var d=a("<div />").addClass("row wms-row").append(a("<div />").addClass("col col--md-12").append(a("<h3 />").addClass("wms-c-title").text("Search for "+r.options.scoped_search_settings.scoped_search_title)).append(a("<div />").addClass("wms-c-scoped-description").text(r.options.scoped_search_settings.scoped_search_desc))),c=a("<div />").addClass("row wms-row").append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+n+" wms-search wms-c-keyword")),p=a("<div />").addClass("row wms-row").attr("id","wms-search-for").append(a("<div />").addClass("col col--md-2").append(a("<h3 />").addClass("wms-c-title").text("Search For:"))).append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+n+" wms-search wms-c-keyword")),l=a("<div />").addClass("row wms-row").attr("id","wms-search-rows"),m=a("<div />").addClass("col "+i+" wms-row").append(a("<button />").attr({type:"submit"}).addClass(" wms-button wms-search wms-submit wms-search-button").text("Search")),h=[{id:"kw",name:"Keyword",paramater:"kw",order:"primary"},{id:"ti",name:"Title",paramater:"ti"},{id:"au",name:"Author",paramater:"au"},{id:"bn",name:"ISBN",paramater:"bn"},{id:"su",name:"Subject",paramater:"su"},{id:"no",name:"OCLC Number",paramater:"no"},{id:"so",name:"Journal Source",paramater:"so"},{id:"yr",name:"Year",paramater:"yr"},{id:"n2",name:"ISSN",paramater:"n2"},{id:"nu",name:"Call Number",paramater:"nu"}],_=[{id:"all",name:"Everything",paramater:"all",order:"primary"},{id:"book",name:"Print Books",paramater:"Book"},{id:"ebook",name:"eBooks",paramater:"Book::book_digital"},{id:"dvd",name:"DVDs",paramater:"Video::video_dvd"},{id:"journal",name:"Journal/Magazine",paramater:"Artchap::artchap_artcl"},{id:"music",name:"Musical Scores",paramater:"Msscr"}],u=function(t,e,s,r){var o,n,d,c=w(s,r),p=[];for(var l in c){if(c[l].hasOwnProperty("order")){d=c[l];break}d=c[0]}a.each(c,function(e,s){n=a("<input />").attr({type:"radio",id:s.paramater,name:t}).val(s.paramater),s.hasOwnProperty("order")?n.attr("checked","checked"):0==e&&n.attr("checked","checked"),o=a("<label />").attr({"class":"wms-select_attr",role:"menuitem",tabindex:"0","aria-hidden":"true","for":s.paramater}).text(s.name).append(n),p.push(o)});var m=a("<div />").addClass("col "+i+" wms-row"),h=a("<div />").addClass("wms-dropdown wms-search").attr({tabindex:"0",role:"button","aria-label":"Search Attribute"}).append(a("<div />").addClass("wms-c-selected").append(a("<span />").addClass("wms-prompt").text(e+":")).append(a("<span />").addClass("wms-selected-item type-"+t).attr({"data-wms_attr":d.paramater,"data-wms_type":t}).text(d.name)).append(a("<span />").addClass("wms-arrow__toggle").html("&#10097;"))),_=a("<div />").addClass("wms-list-options").attr({role:"menu","aria-haspopup":"true"}).append(p);return h.append(_),m.append(h),m},w=function(t,e){return a.each(e,function(a,e){t=t.filter(function(a){return e!==a.id})}),t},g=function(t){var e,s,o,i,n;r.options.scoped_search_settings.scoped_searchbox===!0&&""==r.options.scoped_search_settings.scoped_search_scoping?(e=t.attr,o=r.options.scoped_search_settings.scoped_search_collection):r.options.scoped_search_settings.scoped_searchbox===!0?(e="("+r.options.scoped_search_settings.scoped_search_scoping+") "+r.options.scoped_search_settings.scoped_search_boolean+" "+t.attr,o=r.options.scoped_search_settings.scoped_search_collection):(e=t.attr,o=t.src),t.frmt.match(/(digital|dvd|artchap_artcl)/)&&r.options.scoped_search_settings.scoped_searchbox!==!0?(s="subformat",n=t.frmt):(s="format",n=t.frmt),i=o.match(/::zs:/)?"subscope":"scope";var d={sortKey:r.options.defaults.sortKey,databaseList:r.options.defaults.databaseList,queryString:e,Facet:"",database:r.options.additional_settings.database||"all",author:r.options.additional_settings.author,year:r.options.additional_settings.year||"all",yearFrom:r.options.additional_settings.yearFrom,yearTo:r.options.additional_settings.yearTo,language:r.options.additional_settings.language||"all",topic:r.options.additional_settings.topic};d[i]=o,d[s]=n;var c=r.options.defaults.wms_base_url+a.param(d);return c=c.replace("%26","&")};r.controller=function(){if(r.options.scoped_search_settings.scoped_searchbox===!0){var e=u("attr","AS",h,r.options.additional_settings.omit_attributes);c.append(e,m),o.addClass("grid grid--container").append(d,c)}else{var s=u("attr","AS",h,r.options.additional_settings.omit_attributes),i=u("frmt","FOR",_,r.options.additional_settings.omit_formats),n=u("src","IN",r.options.defaults.collections,r.options.additional_settings.omit_collections);l.append(s,i,n,m),o.append([p,l]).addClass("grid grid--container")}o.on("keypress click",".wms-dropdown",function(t){if(13==t.keyCode||"click"==t.type){var e=a(this),s=e.find(".wms-list-options"),r=e.find(".wms-arrow__toggle");r.toggleClass("toggle-up"),a(".wms-arrow__toggle").not(r).removeClass("toggle-up"),s.slideToggle("fast"),a(".wms-list-options").not(s).slideUp("fast")}}).on("click keypress","label.wms-select_attr",function(t){if((13==t.keyCode||"click"==t.type)&&"LABEL"==t.target.tagName){var e=a(this),s=e.text(),r=e.find("input");e.parents(".wms-search").find(".wms-selected-item").text(s),t.stopPropagation(),r.attr("checked","checked")}}).on("click",".wms-submit",function(e){e.preventDefault();var s="";s=a(".wms-list-options");var o=a('input[name="keyword"]').val(),i=[];r.options.scoped_search_settings.scoped_searchbox===!0&&(i.attr=s.find('input[name="attr"]:checked').attr("value")+":"+o,i.frmt=r.options.scoped_search_settingsscoped_search_format||"all",i.src=r.options.scoped_search_settings.scoped_search_scoping||""),a.each(s,function(t,e){var s=a(e).find('input[type="radio"]:checked');"attr"==s.attr("name")?(i.attr="",i.attr=s.val()+":"+o):"frmt"==s.attr("name")?(i.frmt="",i.frmt=s.val()):"src"==s.attr("name")&&(i.src="",i.src=s.val())});var n=g(i);console.log(n),t.open(n,"_blank"),i=[],s=""}),a("body").on("click",function(t){0===a(t.target).parents(".wms-dropdown").length&&(a(".wms-list-options").slideUp("fast"),a(".wms-arrow__toggle").removeClass("toggle-up"))})}},a.fn.WMSSearch=function(t){return this.each(function(){if(void 0==a(this).data("WMSSearch")){var e=new a.WMSSearch(this,t);e.controller(),a(this).data("WMSSearch",e)}})},a.fn.WMSSearch.options={defaults:{wms_base_url:"https://ccl.on.worldcat.org/search?",sortKey:"LIBRARY",databaseList:"",collections:[{id:"all",name:"General Collections",paramater:"wz:519",order:"primary"},{id:"spcl",name:"Special Collections",paramater:"wz:519::zs:36307"},{id:"oclc",name:"Libraries Worldwide",paramater:"&scope=wz:519"}]},scoped_search_settings:{scoped_searchbox:!1,scoped_search_title:"",scoped_search_desc:"",scoped_search_scoping:"",scoped_search_collection:"",scoped_search_format:"all",scoped_search_boolean:"AND"},additional_settings:{database:"all",author:"",year:"all",yearFrom:"",yearTo:"",language:"all",topic:"",omit_attributes:["n2"],omit_formats:["music"],searchbox_help:"Enter a keyword into the search box to get started",search_attr_help:"What are you searching as? Attributes help you narrow your search",search_source_attr:"Where would you like to search. Here are different collections materials to narrow your search"}}}(jQuery,window,document);