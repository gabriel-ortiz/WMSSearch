!function(e,a,t){"use strict";e.WMSSearch=function(t,s){var r=this,o=e(t),t=t;r.options=e.extend(!0,e.fn.WMSSearch.options,s);var i,n;r.options.scoped_search_settings.scoped_searchbox===!0?(n="col--md-6",i="col--md-3"):(n="col--md-10",i="col--md-3");var d=e("<div />").addClass("row wms-row").append(e("<div />").addClass("col col--md-12").append(e("<h3 />").addClass("wms-c-title").text("Search for "+r.options.scoped_search_settings.scoped_search_title)).append(e("<div />").addClass("wms-c-scoped-description").text(r.options.scoped_search_settings.scoped_search_desc))),c=e("<div />").addClass("row wms-row").append(e("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+n+" wms-search wms-c-keyword")),p=e("<div />").addClass("row wms-row").attr("id","wms-search-for").append(e("<div />").addClass("col col--md-2").append(e("<h3 />").addClass("wms-c-title").text("Search For:"))).append(e("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+n+" wms-search wms-c-keyword")),l=e("<div />").addClass("row wms-row").attr("id","wms-search-rows"),m=e("<div />").addClass("col "+i+" wms-row").append(e("<button />").attr({type:"submit"}).addClass(" wms-button wms-search wms-submit wms-search-button").text("Search")),h=[{id:"kw",name:"Keyword",parameter:"kw",order:"primary"},{id:"ti",name:"Title",parameter:"ti"},{id:"au",name:"Author",parameter:"au"},{id:"bn",name:"ISBN",parameter:"bn"},{id:"su",name:"Subject",parameter:"su"},{id:"no",name:"OCLC Number",parameter:"no"},{id:"so",name:"Journal Source",parameter:"so"},{id:"yr",name:"Year",parameter:"yr"},{id:"n2",name:"ISSN",parameter:"n2"},{id:"nu",name:"Call Number",parameter:"nu"}],_=[{id:"all",name:"Everything",parameter:"all",order:"primary"},{id:"book",name:"Print Books",parameter:"Book"},{id:"ebook",name:"eBooks",parameter:"Book::book_digital"},{id:"dvd",name:"DVDs",parameter:"Video::video_dvd"},{id:"journal",name:"Journal/Magazine",parameter:"Artchap::artchap_artcl"},{id:"music",name:"Musical Scores",parameter:"Msscr"}],u=function(a,t,s,r){var o,n,d,c=w(s,r),p=[];for(var l in c){if(c[l].hasOwnProperty("order")){d=c[l];break}d=c[0]}e.each(c,function(t,s){n=e("<input />").attr({type:"radio",id:s.parameter,name:a}).val(s.parameter),s.hasOwnProperty("order")?n.attr("checked","checked"):0==t&&n.attr("checked","checked"),o=e("<label />").attr({"class":"wms-select_attr",role:"menuitem",tabindex:"0","aria-hidden":"true","for":s.parameter}).text(s.name).append(n),p.push(o)});var m=e("<div />").addClass("col "+i+" wms-row"),h=e("<div />").addClass("wms-dropdown wms-search").attr({tabindex:"0",role:"button","aria-label":"Search Attribute"}).append(e("<div />").addClass("wms-c-selected").append(e("<span />").addClass("wms-prompt").text(t+":")).append(e("<span />").addClass("wms-selected-item type-"+a).attr({"data-wms_attr":d.parameter,"data-wms_type":a}).text(d.name)).append(e("<span />").addClass("wms-arrow__toggle").html("&#10097;"))),_=e("<div />").addClass("wms-list-options").attr({role:"menu","aria-haspopup":"true"}).append(p);return h.append(_),m.append(h),m},w=function(a,t){return e.each(t,function(e,t){a=a.filter(function(e){return t!==e.id})}),a},g=function(a){var t,s,o,i,n;r.options.scoped_search_settings.scoped_searchbox===!0&&""==r.options.scoped_search_settings.scoped_search_scoping?(t=a.attr,o=r.options.scoped_search_settings.scoped_search_collection):r.options.scoped_search_settings.scoped_searchbox===!0?(t="("+r.options.scoped_search_settings.scoped_search_scoping+") "+r.options.scoped_search_settings.scoped_search_boolean+" "+a.attr,o=r.options.scoped_search_settings.scoped_search_collection):(t=a.attr,o=a.src),a.frmt.match(/(digital|dvd|artchap_artcl)/)&&r.options.scoped_search_settings.scoped_searchbox!==!0?(s="subformat",n=a.frmt):(s="format",n=a.frmt),i=o.match(/::zs:/)?"subscope":"scope";var d={sortKey:r.options.defaults.sortKey,databaseList:r.options.defaults.databaseList,queryString:t,Facet:"",database:r.options.additional_settings.database||"all",author:r.options.additional_settings.author,year:r.options.additional_settings.year||"all",yearFrom:r.options.additional_settings.yearFrom,yearTo:r.options.additional_settings.yearTo,language:r.options.additional_settings.language||"all",topic:r.options.additional_settings.topic};d[i]=o,d[s]=n;var c=r.options.defaults.wms_base_url+e.param(d);return c=c.replace("%26","&")};r.controller=function(){if(r.options.scoped_search_settings.scoped_searchbox===!0){var t=u("attr","AS",h,r.options.additional_settings.omit_attributes);c.append(t,m),o.addClass("grid grid--container").append(d,c)}else{var s=u("attr","AS",h,r.options.additional_settings.omit_attributes),i=u("frmt","FOR",_,r.options.additional_settings.omit_formats),n=u("src","IN",r.options.defaults.collections,r.options.additional_settings.omit_collections);l.append(s,i,n,m),o.append([p,l]).addClass("grid grid--container")}o.on("keypress click",".wms-dropdown",function(a){if(13==a.keyCode||"click"==a.type){var t=e(this),s=t.find(".wms-list-options"),r=t.find(".wms-arrow__toggle");r.toggleClass("toggle-up"),e(".wms-arrow__toggle").not(r).removeClass("toggle-up"),s.slideToggle("fast"),e(".wms-list-options").not(s).slideUp("fast")}}).on("click keypress","label.wms-select_attr",function(a){if((13==a.keyCode||"click"==a.type)&&"LABEL"==a.target.tagName){var t=e(this),s=t.text(),r=t.find("input");t.parents(".wms-search").find(".wms-selected-item").text(s),a.stopPropagation(),r.attr("checked","checked")}}).on("click",".wms-submit",function(t){t.preventDefault();var s="";s=e(".wms-list-options");var o=e('input[name="keyword"]').val(),i=[];r.options.scoped_search_settings.scoped_searchbox===!0&&(i.attr=s.find('input[name="attr"]:checked').attr("value")+":"+o,i.frmt=r.options.scoped_search_settingsscoped_search_format||"all",i.src=r.options.scoped_search_settings.scoped_search_scoping||""),e.each(s,function(a,t){var s=e(t).find('input[type="radio"]:checked');"attr"==s.attr("name")?(i.attr="",i.attr=s.val()+":"+o):"frmt"==s.attr("name")?(i.frmt="",i.frmt=s.val()):"src"==s.attr("name")&&(i.src="",i.src=s.val())});var n=g(i);console.log(n),a.open(n,"_blank"),i=[],s=""}),e("body").on("click",function(a){0===e(a.target).parents(".wms-dropdown").length&&(e(".wms-list-options").slideUp("fast"),e(".wms-arrow__toggle").removeClass("toggle-up"))})}},e.fn.WMSSearch=function(a){return this.each(function(){if(void 0==e(this).data("WMSSearch")){var t=new e.WMSSearch(this,a);t.controller(),e(this).data("WMSSearch",t)}})},e.fn.WMSSearch.options={defaults:{wms_base_url:"https://ccl.on.worldcat.org/search?",sortKey:"LIBRARY",databaseList:"",collections:[{id:"all",name:"General Collections",parameter:"wz:519",order:"primary"},{id:"spcl",name:"Special Collections",parameter:"wz:519::zs:36307"},{id:"oclc",name:"Libraries Worldwide",parameter:"&scope=wz:519"}]},scoped_search_settings:{scoped_searchbox:!1,scoped_search_title:"",scoped_search_desc:"",scoped_search_scoping:"",scoped_search_collection:"",scoped_search_format:"all",scoped_search_boolean:"AND"},additional_settings:{database:"all",author:"",year:"all",yearFrom:"",yearTo:"",language:"all",topic:"",omit_attributes:["n2"],omit_formats:["music"],searchbox_help:"Enter a keyword into the search box to get started",search_attr_help:"What are you searching as? Attributes help you narrow your search",search_source_attr:"Where would you like to search. Here are different collections materials to narrow your search"}}}(jQuery,window,document);