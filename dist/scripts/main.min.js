!function(a,e,t){"use strict";a.WMSSearch=function(t,s){var r=this,o=a(t),t=t;r.options=a.extend(!0,a.fn.WMSSearch.options,s);var i,n,d=r.options.scoped_search_settings.scoped_searchbox===!0?!0:!1;d?(n="col--md-6",i="col--md-3"):(n="col--md-10",i="col--md-3");var c=a("<div />").addClass("row wms-row").append(a("<div />").addClass("col col--md-12").append(a("<h3 />").addClass("wms-c-title").text("Search for "+r.options.scoped_search_settings.scoped_search_title)).append(a("<div />").addClass("wms-c-scoped-description").text(r.options.scoped_search_settings.scoped_search_desc))),p=a("<div />").addClass("row wms-row").append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+n+" wms-search wms-c-keyword")),l=a("<div />").addClass("row wms-row").attr("id","wms-search-for").append(a("<div />").addClass("col col--md-2").append(a("<h3 />").addClass("wms-c-title").text("Search For:"))).append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+n+" wms-search wms-c-keyword")),m=a("<div />").addClass("row wms-row").attr("id","wms-search-rows"),h=a("<div />").addClass("col "+i+" wms-row").append(a("<button />").attr({type:"submit"}).addClass(" wms-button wms-search wms-submit wms-search-button").text("Search"));r.default_search_attrs=[{id:"kw",name:"Keyword",parameter:"kw",order:"primary"},{id:"ti",name:"Title",parameter:"ti"},{id:"au",name:"Author",parameter:"au"},{id:"bn",name:"ISBN",parameter:"bn"},{id:"su",name:"Subject",parameter:"su"},{id:"no",name:"OCLC Number",parameter:"no"},{id:"so",name:"Journal Source",parameter:"so"},{id:"yr",name:"Year",parameter:"yr"},{id:"n2",name:"ISSN",parameter:"n2"},{id:"nu",name:"Call Number",parameter:"nu"}],r.default_search_formats=[{id:"all",name:"Everything",parameter:"all",order:"primary"},{id:"book",name:"Print Books",parameter:"Book"},{id:"ebook",name:"eBooks",parameter:"Book::book_digital"},{id:"dvd",name:"DVDs",parameter:"Video::video_dvd"},{id:"journal",name:"Journal/Magazine",parameter:"Artchap::artchap_artcl"},{id:"music",name:"Musical Scores",parameter:"Msscr"}];var _=function(e,t,s,r){var o,n,d,c=u(s,r),p=[];for(var l in c){if(c[l].hasOwnProperty("order")){d=c[l];break}d=c[0]}a.each(c,function(t,s){n=a("<input />").attr({type:"radio",id:s.parameter,name:e}).val(s.parameter),s.hasOwnProperty("order")?n.attr("checked","checked"):0==t&&n.attr("checked","checked"),o=a("<label />").attr({"class":"wms-select_attr",role:"menuitem",tabindex:"0","aria-hidden":"true","for":s.parameter}).text(s.name).append(n),p.push(o)});var m=a("<div />").addClass("col "+i+" wms-row"),h=a("<div />").addClass("wms-dropdown wms-search").attr({tabindex:"0",role:"button","aria-label":"Search by specifying an attribute"}).append(a("<div />").addClass("wms-c-selected").append(a("<span />").addClass("wms-prompt").text(t+":")).append(a("<span />").addClass("wms-selected-item type-"+e).attr({"data-wms_attr":d.parameter,"data-wms_type":e}).text(d.name)).append(a("<span />").addClass("wms-arrow__toggle").html("&#10097;"))),_=a("<fieldset />").addClass("wms-list-options").attr({role:"dropdown list","aria-haspopup":"true"}).append(p);return m.append(h,_),m},u=function(e,t){return a.each(t,function(a,t){e=e.filter(function(a){return t!==a.id})}),e},w=function(e){var t,s,o,i,n;d&&""==r.options.scoped_search_settings.scoped_search_scoping?(t=e.attr,o=r.options.scoped_search_settings.scoped_search_collection):d?(t="("+r.options.scoped_search_settings.scoped_search_scoping+") "+r.options.scoped_search_settings.scoped_search_boolean+" "+e.attr,o=r.options.scoped_search_settings.scoped_search_collection):(t=e.attr,o=e.src),e.frmt.match(/(digital|dvd|artchap_artcl)/)&&r.options.scoped_search_settings.scoped_searchbox!==!0?(s="subformat",n=e.frmt):(s="format",n=e.frmt),i=o.match(/::zs:/)?"subscope":"scope";var c={sortKey:r.options.defaults.sortKey,databaseList:r.options.defaults.databaseList,queryString:t,Facet:"",database:r.options.additional_settings.database||"all",author:r.options.additional_settings.author,year:r.options.additional_settings.year||"all",yearFrom:r.options.additional_settings.yearFrom,yearTo:r.options.additional_settings.yearTo,language:r.options.additional_settings.language||"all",topic:r.options.additional_settings.topic};c[i]=o,c[s]=n;var p=r.options.defaults.wms_base_url+a.param(c);return p=p.replace("%26","&")};r.controller=function(){if(d){var t=_("attr","AS",r.default_search_attrs,r.options.additional_settings.omit_attributes);p.append(t,h),o.addClass("grid grid--container").append(c,p)}else{var s=_("attr","AS",r.default_search_attrs,r.options.additional_settings.omit_attributes),i=_("frmt","FOR",r.default_search_formats,r.options.additional_settings.omit_formats),n=_("src","IN",r.options.defaults.collections,r.options.additional_settings.omit_collections);m.append(s,i,n,h),o.append([l,m]).addClass("grid grid--container")}o.on("keypress click focus",".wms-dropdown",function(e){var t=a(this),s=t.siblings(".wms-list-options"),r=t.find(".wms-arrow__toggle");r.addClass("toggle-up"),a(".wms-arrow__toggle").not(r).removeClass("toggle-up"),s.slideDown("fast"),a(".wms-list-options").not(s).slideUp("fast")}).on("click keypress","label.wms-select_attr",function(e){if(13==e.keyCode||32==e.charCode||"click"==e.type){if("LABEL"==e.target.tagName){var t=a(this),s=t.text(),r=t.find("input");t.parents(".wms-list-options").siblings(".wms-dropdown").find(".wms-selected-item").text(s).parents(".wms-list-options").slideUp("fast"),r.attr("checked","checked")}t.parents(".wms-list-options").slideUp("fast")}}).on("click",".wms-submit",function(t){t.preventDefault();var s="";s=a(".wms-list-options");var o=a('input[name="keyword"]').val(),i=[];d&&(i.attr=s.find('input[name="attr"]:checked').attr("value")+":"+o,i.frmt=r.options.scoped_search_settingsscoped_search_format||"all",i.src=r.options.scoped_search_settings.scoped_search_scoping||""),a.each(s,function(e,t){var s=a(t).find('input[type="radio"]:checked');"attr"==s.attr("name")?(i.attr="",i.attr=s.val()+":"+o):"frmt"==s.attr("name")?(i.frmt="",i.frmt=s.val()):"src"==s.attr("name")&&(i.src="",i.src=s.val())});var n=w(i);console.log(n),e.open(n,"_blank"),i=[],s=""}),a("body").on("click",function(e){0===a(e.target).parents(".wms-dropdown").length&&(a(".wms-list-options").slideUp("fast"),a(".wms-arrow__toggle").removeClass("toggle-up"))})}},a.fn.WMSSearch=function(e){return this.each(function(){if(void 0==a(this).data("WMSSearch")){var t=new a.WMSSearch(this,e);t.controller(),a(this).data("WMSSearch",t)}})},a.fn.WMSSearch.options={defaults:{wms_base_url:"https://ccl.on.worldcat.org/search?",sortKey:"LIBRARY",databaseList:"",collections:[{id:"all",name:"General Collections",parameter:"wz:519",order:"primary"},{id:"spcl",name:"Special Collections",parameter:"wz:519::zs:36307"},{id:"oclc",name:"Libraries Worldwide",parameter:"all"}]},scoped_search_settings:{scoped_searchbox:!1,scoped_search_title:"",scoped_search_desc:"",scoped_search_scoping:"",scoped_search_collection:"",scoped_search_format:"all",scoped_search_boolean:"AND"},additional_settings:{database:"all",author:"",year:"all",yearFrom:"",yearTo:"",language:"all",topic:"",omit_attributes:["n2"],omit_formats:["music"],searchbox_help:"Enter a keyword into the search box to get started",search_attr_help:"What are you searching as? Attributes help you narrow your search",search_source_attr:"Where would you like to search. Here are different collections materials to narrow your search"}}}(jQuery,window,document);