!function(a,t,e){"use strict";a.WMSSearch=function(t,e){var s=this,o=a(t),t=t;s.options=a.extend(!0,a.fn.WMSSearch.options,e);var r,i;s.options.scoped_search_settings.scoped_searchbox===!0?(i="col--md-6",r="col--md-3"):(i="col--md-10",r="col--md-3");var n=a("<div />").addClass("row wms-row").append(a("<div />").addClass("col col--md-12").append(a("<h3 />").addClass("wms-c-title").text("Search for "+s.options.scoped_search_settings.scoped_search_title)).append(a("<div />").addClass("wms-c-scoped-description").text(s.options.scoped_search_settings.scoped_search_desc))),d=a("<div />").addClass("row wms-row").append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+i+" wms-search wms-c-keyword")),c=a("<div />").addClass("row wms-row").attr("id","wms-search-for").append(a("<div />").addClass("col col--md-2").append(a("<h3 />").addClass("wms-c-title").text("Search For:"))).append(a("<input />").attr({type:"text",name:"keyword",placeholder:"Start typing your search"}).addClass("col "+i+" wms-search wms-c-keyword")),p=a("<div />").addClass("row wms-row").attr("id","wms-search-rows"),l=a("<div />").addClass("col "+r+" wms-row").append(a("<button />").attr({type:"submit"}).addClass(" wms-button wms-search wms-submit wms-search-button").text("Search")),m=[{id:"kw",name:"Keyword",paramater:"kw",order:"primary"},{id:"ti",name:"Title",paramater:"ti"},{id:"au",name:"Author",paramater:"au"},{id:"bn",name:"ISBN",paramater:"bn"},{id:"su",name:"Subject",paramater:"su"},{id:"no",name:"OCLC Number",paramater:"no"},{id:"so",name:"Journal Source",paramater:"so"},{id:"yr",name:"Year",paramater:"yr"},{id:"n2",name:"ISSN",paramater:"n2"},{id:"nu",name:"Call Number",paramater:"nu"}],h=[{id:"all",name:"Everything",paramater:"all",order:"primary"},{id:"book",name:"Print Books",paramater:"Book"},{id:"ebook",name:"eBooks",paramater:"Book::book_digital"},{id:"dvd",name:"DVDs",paramater:"Video::video_dvd"},{id:"journal",name:"Journal/Magazine",paramater:"Artchap::artchap_artcl"},{id:"music",name:"Musical Scores",paramater:"Msscr"}],_=function(t,e,s,o){var i,n,d,c=u(s,o),p=[];for(var l in c){if(c[l].hasOwnProperty("order")){d=c[l];break}d=c[0]}console.log(d),a.each(c,function(e,s){n=a("<input />").attr({type:"radio",id:s.paramater,name:t}).val(s.paramater),s.hasOwnProperty("order")?n.attr("checked","checked"):0==e&&n.attr("checked","checked"),i=a("<label />").attr({"class":"wms-select_attr",role:"menuitem",tabindex:"0","aria-hidden":"true","for":s.paramater}).text(s.name).append(n),p.push(i)});var m=a("<div />").addClass("col "+r+" wms-row"),h=a("<div />").addClass("wms-dropdown wms-search").attr({tabindex:"0",role:"button","aria-label":"Search Attribute"}).append(a("<div />").addClass("wms-c-selected").append(a("<span />").addClass("wms-prompt").text(e+":")).append(a("<span />").addClass("wms-selected-item type-"+t).attr({"data-wms_attr":d.paramater,"data-wms_type":t}).text(d.name)).append(a("<span />").addClass("wms-arrow__toggle").html("&#10097;"))),_=a("<div />").addClass("wms-list-options").attr({role:"menu","aria-haspopup":"true"}).append(p);return h.append(_),m.append(h),m},u=function(t,e){return a.each(e,function(a,e){t=t.filter(function(a){return e!==a.id})}),t},w=function(t){var e,o,r,i,n;s.options.scoped_search_settings.scoped_searchbox===!0&&""==s.options.scoped_search_settings.scoped_search_scoping?(e=t.attr,r=s.options.scoped_search_settings.scoped_search_collection):s.options.scoped_search_settings.scoped_searchbox===!0?(e="("+s.options.scoped_search_settings.scoped_search_scoping+") "+s.options.scoped_search_settings.scoped_search_boolean+" "+t.attr,r=s.options.scoped_search_settings.scoped_search_collection):(e=t.attr,r=t.src),t.frmt.match(/(digital|dvd|artchap_artcl)/)&&s.options.scoped_search_settings.scoped_searchbox!==!0?(o="subformat",n=t.frmt):(o="format",n=t.frmt),i=r.match(/::zs:/)?"subscope":"scope";var d={sortKey:s.options.defaults.sortKey,databaseList:s.options.defaults.databaseList,queryString:e,Facet:"",database:s.options.additional_settings.database||"all",author:s.options.additional_settings.author,year:s.options.additional_settings.year||"all",yearFrom:s.options.additional_settings.yearFrom,yearTo:s.options.additional_settings.yearTo,language:s.options.additional_settings.language||"all",topic:s.options.additional_settings.topic};d[i]=r,d[o]=n;var c=s.options.defaults.wms_base_url+a.param(d);return c=c.replace("%26","&")};s.controller=function(){if(s.options.scoped_search_settings.scoped_searchbox===!0){var t=_("attr","AS",m,s.options.additional_settings.omit_attributes);d.append(t,l),o.addClass("grid grid--container").append(n,d)}else{var e=_("attr","AS",m,s.options.additional_settings.omit_attributes),r=_("frmt","FOR",h,s.options.additional_settings.omit_formats),i=_("src","IN",s.options.defaults.collections,s.options.additional_settings.omit_collections);p.append(e,r,i,l),o.append([c,p]).addClass("grid grid--container")}o.on("keypress click",".wms-dropdown",function(t){if(13==t.keyCode||"click"==t.type){var e=a(this),s=e.find(".wms-list-options"),o=e.find(".wms-arrow__toggle");o.toggleClass("toggle-up"),a(".wms-arrow__toggle").not(o).removeClass("toggle-up"),s.slideToggle("fast"),a(".wms-list-options").not(s).slideUp("fast")}}).on("click keypress","label.wms-select_attr",function(t){if((13==t.keyCode||"click"==t.type)&&"LABEL"==t.target.tagName){{var e=a(this),s=e.text();e.find("input").val()}e.parents(".wms-search").find(".wms-selected-item").text(s),t.stopPropagation()}}).on("click",".wms-submit",function(t){t.preventDefault();var e="";e=a(".wms-list-options");var o=a('input[name="keyword"]').val(),r=[];s.options.scoped_search_settings.scoped_searchbox===!0&&(r.attr=e.find('input[name="attr"]:checked').attr("value")+":"+o,r.frmt=s.options.scoped_search_settingsscoped_search_format||"all",r.src=s.options.scoped_search_settings.scoped_search_scoping||""),a.each(e,function(t,e){var s=a(e).find('input[type="radio"]:checked');"attr"==s.attr("name")?(r.attr="",r.attr=s.val()+":"+o):"frmt"==s.attr("name")?(r.frmt="",r.frmt=s.val()):"src"==s.attr("name")&&(r.src="",r.src=s.val())});var i=w(r);console.log(i),r=[],e=""}),a("body").on("click",function(t){0===a(t.target).parents(".wms-dropdown").length&&(a(".wms-list-options").slideUp("fast"),a(".wms-arrow__toggle").removeClass("toggle-up"))})}},a.fn.WMSSearch=function(t){return this.each(function(){if(void 0==a(this).data("WMSSearch")){var e=new a.WMSSearch(this,t);e.controller(),a(this).data("WMSSearch",e)}})},a.fn.WMSSearch.options={defaults:{wms_base_url:"https://ccl.on.worldcat.org/search?",sortKey:"LIBRARY",databaseList:"",collections:[{id:"all",name:"General Collections",paramater:"wz:519",order:"primary"},{id:"spcl",name:"Special Collections",paramater:"wz:519::zs:36307"},{id:"oclc",name:"Libraries Worldwide",paramater:"&scope=wz:519"}]},scoped_search_settings:{scoped_searchbox:!1,scoped_search_title:"",scoped_search_desc:"",scoped_search_scoping:"",scoped_search_collection:"",scoped_search_format:"all",scoped_search_boolean:"AND"},additional_settings:{database:"all",author:"",year:"all",yearFrom:"",yearTo:"",language:"all",topic:"",omit_attributes:["n2"],omit_formats:["music"],searchbox_help:"Enter a keyword into the search box to get started",search_attr_help:"What are you searching as? Attributes help you narrow your search",search_source_attr:"Where would you like to search. Here are different collections materials to narrow your search"}}}(jQuery,window,document);